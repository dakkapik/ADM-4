<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test client</title>
</head>
<body>
    
</body>
<script>
//     fetch('http://localhost:3000/measurements.json')
//     .then(async (response) => {
//         // response.body is a ReadableStream
//         const reader = response.body.getReader();
//         for await (const chunk of readChunks(reader)) {
//             console.log(`received chunk of size ${chunk.length}`);
//         }
//     });

// // readChunks() reads from the provided reader and yields the results into an async iterable
// function readChunks(reader) {
//     return {
//         async* [Symbol.asyncIterator]() {
//             let readResult = await reader.read();
//             while (!readResult.done) {
//                 yield readResult.value;
//                 readResult = await reader.read();
//             }
//         },
//     };
// }

fetch('http://localhost:3000/measurements.json')
    .then(async (response) => {
        let measurementsReceived = 0;
        for await (const measurement of parseJsonStream(response.body)) {
            measurementsReceived++;
            // To prevent the console from flooding we only show 1 in every 100 measurements
            if (measurementsReceived % 100 === 0) {
                console.log(`measurement with id {${measurement.id}} at time ${measurement.timestamp} has value [${measurement.value}]`);
            }
        }
    });
</script>
</html>